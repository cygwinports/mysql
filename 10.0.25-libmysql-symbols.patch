--- origsrc/mariadb-10.0.25/libmysql/CMakeLists.txt	2016-04-28 15:27:44.000000000 -0500
+++ src/mariadb-10.0.25/libmysql/CMakeLists.txt	2016-05-20 14:11:01.219447500 -0500
@@ -273,26 +273,6 @@ SET(CLIENT_API_FUNCTIONS
   "Client functions"
 )
 
-IF(CMAKE_SYSTEM_NAME MATCHES "Linux") 
-  IF (NOT DISABLE_LIBMYSQLCLIENT_SYMBOL_VERSIONING)
-
-    INCLUDE (CheckCSourceCompiles)
-    FILE(WRITE "${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp/src.ld"
-      "VERSION {\nlibmysqlclient_18 {\nglobal: *;\n};\n}\n")
-    SET(CMAKE_REQUIRED_LIBRARIES "-Wl,src.ld")
-    CHECK_C_SOURCE_COMPILES("int main() { return 0; }"
-      SUPPORTS_VERSION_IN_LINK_SCRIPT)
-    SET(CMAKE_REQUIRED_LIBRARIES)
-
-    IF (NOT SUPPORTS_VERSION_IN_LINK_SCRIPT)
-      # https://sourceware.org/bugzilla/show_bug.cgi?id=16895
-      MESSAGE(SEND_ERROR "Your current linker does not support VERSION "
-        "command in linker scripts like a GNU ld or any compatible linker "
-        "should. Perhaps you're using gold? Either switch to GNU ld compatible "
-        "linker or run cmake with -DDISABLE_LIBMYSQLCLIENT_SYMBOL_VERSIONING=TRUE "
-        "to be able to complete the build")
-    ENDIF (NOT SUPPORTS_VERSION_IN_LINK_SCRIPT)
-
   # When building RPM, or DEB package on Debian, use ELF symbol versioning
   # for compatibility with distribution packages, so client shared library can 
   # painlessly replace the one supplied by the distribution.
@@ -303,20 +283,8 @@ IF(CMAKE_SYSTEM_NAME MATCHES "Linux")
   
   # Fedora & Co declared following functions as part of API 
   SET(CLIENT_API_5_1_EXTRA
-    # why does Fedora export these?
-    _fini
-    _init
     my_init
 
-    #  mysql-connector-odbc requires these
-    mysql_default_charset_info
-    mysql_get_charset
-    mysql_get_charset_by_csname
-    mysql_net_realloc
-
-    # PHP's mysqli.so requires this (via the ER() macro)
-    mysql_client_errors
-
     # Also export the non-renamed variants
     # (in case someone wants to rebuild mysqli-php or something similar)
     # See MDEV-4127
@@ -377,6 +345,26 @@ IF(CMAKE_SYSTEM_NAME MATCHES "Linux")
     make_scrambled_password_323
   )
 
+IF(CMAKE_SYSTEM_NAME MATCHES "Linux") 
+  IF (NOT DISABLE_LIBMYSQLCLIENT_SYMBOL_VERSIONING)
+
+    INCLUDE (CheckCSourceCompiles)
+    FILE(WRITE "${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeTmp/src.ld"
+      "VERSION {\nlibmysqlclient_18 {\nglobal: *;\n};\n}\n")
+    SET(CMAKE_REQUIRED_LIBRARIES "-Wl,src.ld")
+    CHECK_C_SOURCE_COMPILES("int main() { return 0; }"
+      SUPPORTS_VERSION_IN_LINK_SCRIPT)
+    SET(CMAKE_REQUIRED_LIBRARIES)
+
+    IF (NOT SUPPORTS_VERSION_IN_LINK_SCRIPT)
+      # https://sourceware.org/bugzilla/show_bug.cgi?id=16895
+      MESSAGE(SEND_ERROR "Your current linker does not support VERSION "
+        "command in linker scripts like a GNU ld or any compatible linker "
+        "should. Perhaps you're using gold? Either switch to GNU ld compatible "
+        "linker or run cmake with -DDISABLE_LIBMYSQLCLIENT_SYMBOL_VERSIONING=TRUE "
+        "to be able to complete the build")
+    ENDIF (NOT SUPPORTS_VERSION_IN_LINK_SCRIPT)
+
   # Generate version script.  
   # Create semicolon separated lists of functions to export from 
   # Since RPM packages use separate versioning for 5.1 API
@@ -503,6 +491,7 @@ IF(NOT DISABLE_SHARED)
     SET_TARGET_PROPERTIES(mysqlclient PROPERTIES CLEAN_DIRECT_OUTPUT 1)
     SET_TARGET_PROPERTIES(libmysql PROPERTIES CLEAN_DIRECT_OUTPUT 1)
 
+    IF(NOT CYGWIN)
     # Install links to libmysqlclient.so (client_r)
     GET_VERSIONED_LIBNAME(
       "${CMAKE_SHARED_LIBRARY_PREFIX}mysqlclient_r"
@@ -520,5 +509,6 @@ IF(NOT DISABLE_SHARED)
         linkname)
       INSTALL_SYMLINK(${linkname} libmysql ${INSTALL_LIBDIR} SharedLibraries)
     ENDFOREACH()
+    ENDIF()
   ENDIF()
 ENDIF()
